DECLARE @k0105 NUMERIC(10,3),@k0106 NUMERIC(10,3),@k0101 varchar(15),@DIFF NUMERIC(10,3)
set @k0105=1016
set	@k0106=1065.952
--SET @DIFF=49.952
SET @DIFF=@k0106-@k0105
set @k0101 ='G4'
SELECT K0101,FLOOR(@k0105),CEILING(@k0106),SUM(ISNULL(A5011,0)*A5008/1000)/@DIFF
FROM K05 
WHERE A0102 LIKE '42A%'
			AND A0101A ='2022'
			--AND K0101 LIKE 'G0421%'
			AND K0101 = @k0101
			AND A5009 ='2'
			AND LEFT(K0101,1)='G'
			AND K0105>=FLOOR(@k0105 )			AND K0106<=CEILING(@k0106)
GROUP BY K0101


SELECT @k0101,@k0105,FLOOR(@k0105),@k0106,CEILING(@k0106),@DIFF
/*
union
SELECT K0101,A5011,A5008,0
FROM K05 
WHERE A0102 LIKE '42A%'
			AND A0101A ='2022'
			--AND K0101 LIKE 'G0421%'
			AND K0101 = 'G4'
			AND A5009 ='2'
			AND LEFT(K0101,1)='G'
			AND K0105>=1148 			AND K0106<=1158
GROUP BY K0101,A5011,A5008		
*/