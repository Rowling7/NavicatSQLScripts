-----------------12.1.ah
/*不显示零*/
SELECT 
CASE WHEN GROUPING(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(B17.K0101,'340000',''),'000000',''),'D001',''),'D002',''),'D003','')))=1 THEN '合计' 
	ELSE MAX(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(B17.K0101,'340000',''),'000000',''),'D001',''),'D002',''),'D003','')))
END K0101,
CASE WHEN GROUPING(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(B17.K0101,'340000',''),'000000',''),'D001',''),'D002',''),'D003','')))=1 THEN ''
	ELSE MAX(RTRIM(A50.K0112)) 
END K0112,
SUM(ISNULL(A3011,0)+ISNULL(A3065,0)+ISNULL(A3078,0)+ISNULL(A3086,0)+ISNULL(A3087,0)) HEJI,		--本年完成投资合计
SUM(ISNULL(A3011,0)),		--日常养护本年完成投资
SUM(ISNULL(A3065,0)),		--预防养护本年完成投资
SUM(ISNULL(A3076,0)),		--预防养护本年完成投资_路面工程
SUM(ISNULL(A3077,0)),		--预防养护本年完成里程_路面工程
SUM(ISNULL(A3078,0)),		--修复养护本年完成投资
SUM(ISNULL(A3080,0)),		--修复养护本年完成投资_路面工程
SUM(ISNULL(A3081,0)),		--修复养护本年完成里程_路面工程
SUM(ISNULL(A3082,0)),		--修复养护本年完成投资_桥梁工程
SUM(ISNULL(A3083,0)),		--修复养护本年完成长度_桥梁工程
SUM(ISNULL(A3084,0)),		--修复养护本年完成投资_隧道工程
SUM(ISNULL(A3085,0)),		--修复养护本年完成长度_隧道工程
SUM(ISNULL(A3086,0)),		--专项养护本年完成长度
SUM(ISNULL(A3087,0)),		--应急养护本年完成长度
SUM(ISNULL(A3088,0)),		--本年绿化投放资金
sum(isnull(a3092,0)) a3092,--废旧沥青路面材料生成量
	sum(isnull(a3093,0)) a3093,--废旧沥青路面材料循环利用量
CAST(sum(isnull(a3093,0))/nullif(sum(isnull(a3092,0)),0)*100 as NUMERIC(5,2)) a3091,--公路废旧沥青路面材料循环利用率
--CAST(SUM(CASE WHEN ISNULL(A3077,0)<>0 OR ISNULL(A3081,0)<>0 THEN (ISNULL(A3077,0)+ISNULL(A3081,0))*ISNULL(A3091,0) ELSE 0 END)/
--	NULLIF(SUM(CASE WHEN ISNULL(A3077,0)<>0 OR ISNULL(A3081,0)<>0 THEN ISNULL(A3077,0)+ISNULL(A3081,0) ELSE 0 END),0) AS NUMERIC(5,2))  a3091 --（旧算法）公路废旧沥青路面材料循环利用率
a3094,RTRIM(ha3094),--循环利用方式
sum(isnull(a3095,0)) a3095 --废旧沥青路面材料实际用量
FROM B17
LEFT JOIN A50 ON B17.A0102=A50.A0102 AND B17.K0101=A50.K0101
WHERE B17.A0102 LIKE '34%' AND LEN(B17.K0101)<10
	AND B17.A0101 = '2023'
GROUP BY RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(B17.K0101,'340000',''),'000000',''),'D001',''),'D002',''),'D003','')),a3094,ha3094 WITH ROLLUP
having grouping(a3094)=grouping(ha3094)  and (grouping(a3094)=0 or (grouping(a3094)=1 and grouping(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(B17.K0101,'340000',''),'000000',''),'D001',''),'D002',''),'D003','')))=1))
ORDER BY RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(B17.K0101,'340000',''),'000000',''),'D001',''),'D002',''),'D003',''))
