
SELECT LDBM,YHLC,Z,RTRIM(LK.K0101)+RTRIM(LK.K0115),LK.A1001 LA1001,RTRIM(K.K0101)+RTRIM(K.K0115),K.A1001 A1001
--UPDATE T_LD SET YHLC=NULL
from T_LD 
LEFT JOIN (
SELECT a,SUBSTRING(a,charindex(',路段代码=',a)+7,13) Z
from OPENROWSET('Microsoft.JET.OLEDB.4.0','Excel 5.0;HDR=YES;DATABASE=D:\Desktop\表0118.xls',sheet6$)
)XLS ON LDBM=XLS.Z
LEFT JOIN [HRP-DBMS2014-2022年报]..K001 LK ON RTRIM(LK.K0101)+RTRIM(LK.K0115)= XLS.Z
LEFT JOIN [HRP-DBMS2014]..K001 K ON RTRIM(K.K0101)+RTRIM(K.K0115)= XLS.Z
WHERE XLS.Z IS NOT NULL




SELECT
a,SUBSTRING(a,charindex(',路段代码=',a)+7,13) xlsa,
b,SUBSTRING(b,charindex(',路段代码=',b)+7,13) xlsb,
c,SUBSTRING(c,charindex(',路段代码=',c)+7,13) xlsc
from OPENROWSET('Microsoft.JET.OLEDB.4.0','Excel 5.0;HDR=YES;DATABASE=D:\Desktop\表0119.xls',sheet1$)





--查询上年路线编码和去年里程
DECLARE @K0101 VARCHAR(200)
SET @K0101='Y142341302'--X018340212 X22734021
SELECT A0102,HA0102,RTRIM(K0101) K0101,RTRIM(K0115) K0115,K0108,K0109,K0114,'2023年' A,K1302 '上年路线编码',K1303'上年起点桩号',K1304'上年止点桩号',K0180,K3912,HK3912,HK5104,HK0304,K0123,K5404,hK0404
FROM K001  
WHERE K1302 LIKE @K0101+'%' OR K0101 LIKE @K0101+'%'
UNION
SELECT A0102,HA0102,RTRIM(K0101) K0101,RTRIM(K0115) K0115,K0108,K0109,K0114,'---2022年' A,K1302 '上年路线编码',K1303'上年起点桩号',K1304'上年止点桩号',K0180,K3912,HK3912,HK5104,HK0304,K0123,K5404,hK0404
FROM LUDUAN
WHERE K0101 LIKE @K0101+'%'
ORDER BY A DESC ,K0108 ASC