----“原路线代码”未填写
if exists(select * from tempdb..sysobjects where id=object_id('tempdb..#tk001')) drop table #tk001

select  RTRIM(k.a0102) A0102,RTRIM(k.k0101) K0101,min(k.k0108) k0108,max(k.k0109) k0109
INTO #TK001
from LUDUAN k
WHERE LEFT(K.K0101,1)<>'W' 
and left(k.K0101,1) in ('X','Y','Z','C')
group by k.a0102,k.k0101
ORDER BY k.a0102,k.k0101
SELECT * FROM #TK001 
--where  k0101 ='C247340210'
ORDER BY #TK001.a0102,#TK001.k0101,#TK001.k0108

SELECT RTRIM(K.A0102) A0102,RTRIM(K.K0101) K0101,RTRIM(L.A0102) LA0102,RTRIM(L.K0101) LK0101, K.K0108,K.K0109 , K.K0180,K.HA3219,K.hk3912,k.k1302 ,k.k1303 ,L.K0108 LK0108,k.k1304,L.K0109 LK0109 --,RTRIM(K.KWYID) KWYID,RTRIM(L.KWYID) LKWYID
--在路线范围内
--UPDATE K SET K.k1302=K.K0101 ,k1303 =k.K0108,k1304=k.K0109
FROM K001  K 
LEFT JOIN #TK001 L ON K.A0102=L.A0102 AND K.K0101=L.K0101 

AND K.K0108<L.K0108 --AND K.K0109<=L.K0109 
where  k.a3219<>'1'  and RTRIM(L.A0102)is not null 
and k.k1302 is null
and left(k.K0101,1) in ('X','Y','Z','C')
ORDER BY RTRIM(K.A0102) ,RTRIM(K.K0101),K.K0108


SELECT 
	B.HA0102,B.K0101,B.K0108,A.HK1301,B.K1302,B.K1303,B.K1304
FROM A50 A INNER JOIN K001 B ON A.A0102=B.A0102 AND A.K0101=B.K0101
	LEFT JOIN LUDUAN C ON LTRIM(RTRIM(B.K1302))=C.K0101 AND ISNULL(B.K1303,9999)>=C.K0108 AND ISNULL(B.K1303,9999)<C.K0109
WHERE (ISNULL(B.K1303,9999)<>9999 AND C.K0101 IS NULL) OR LEFT(LTRIM(RTRIM(B.K1302)),1) NOT IN ('X','Y','Z','C') 
